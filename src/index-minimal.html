<!-- GUIEasy  Copyright (C) 2019-2020  Jimmy "Grovkillen" Westberg -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#000000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,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">
    <title>ESP Easy</title>
    <style>
        :root {
            --frontend-color: 0, 255, 45;
            --backend-color: 100, 200, 245;
            --manual-color: 255, 255, 45;
            --offline-color: 255, 0, 45;
            /*--color: var(--frontend-color);*/
            --color-1: rgb(var(--color));
            --color-2: rgba(var(--color), 0.4);
        }
        ::-webkit-scrollbar:window-inactive,
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--color-1);
        }
        body {
            color: var(--color-1);
            background: black;
            font-family: monospace;
            text-align: justify;
            font-size: 1.1em;
            scrollbar-color: var(--color-2) var(--color-2); /* thumb and track color */
            scrollbar-width: thin;
        }
        button{
             display: none;
             width: 100%;
             border-color: var(--color-1);
             border-style: solid;
             border-width: 1px;
             color: var(--color-1);
             background: transparent;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             outline: 0;
             padding: .65em 2em;
             font-family: inherit;
        }
        button.active {
            background-color: var(--color-2);
        }
        select {
            display: none;
            width: 100%;
            border-color: var(--color-1);
            border-style: solid;
            border-width: 1px;
            color: var(--color-1);
            background: transparent;
            text-align-last: center;
            text-align: center;
            cursor: pointer;
            outline: 0;
            padding: .65em 2em;
            font-family: inherit;
        }
        select option {
            transition: 250ms;
            background: black;
            color: var(--color-1);
        }
        select option:hover {
            color: black;
            background-color: var(--color-1);
        }
        select option:checked {
            background: linear-gradient(to bottom, var(--color-1) 0%, var(--color-1) 100%);
        }
        #x {
            min-width: 300px;
            max-width: 300px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #a {
            display: none;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        #p {
            background-color: var(--color-1);
            height: 3px;
            margin-bottom: 10px;
        }
        #t {
            display: none;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        #upload {
            display: none;
            min-height: 240px;
            max-height: 240px;
        }
        .drag-drop {
            border-style: dashed;
        }
    </style>
    <script>
        let obj = {};
        obj.list = [];
        obj.file = "";
        obj.frontend = {
            "b": "Upgrade Front End",
            "a": "Select version in the dropdown below (latest is always first):",
            "baseURL": "https://raw.githubusercontent.com/letscontrolit/GUIEasy/master/build/",
            "rlEndpoint": "releases.txt",
            "infoEndpoint": "release.txt",
            "t": "Click the button below to upgrade this unit."
        };
        obj.backend = {
            "b": "Update Firmware",
            "a": "Select version in the dropdown below (latest is always first):",
            "baseURL": "https://raw.githubusercontent.com/letscontrolit/GUIEasy/master/build/",
            "rlEndpoint": "releases.txt",
            "infoEndpoint": "release.txt",
            "t": "Click the button below to upgrade this unit to selected firmware version."
        };
        let fe, be, r, rc, n, t, d, f, m, upload, b, a, p;
        ini = function () {
            start('frontend');
            dragDropEvent();
        };
        start = async function (type) {
            document.body.dataset.type = type;
            fe = document.getElementById("fe"); //front end button
            be = document.getElementById("be"); //back end button
            m = document.getElementById("m"); //manual button
            upload = document.getElementById("upload"); //manual upload button
            r = document.getElementById("r"); //filter release button
            rc = document.getElementById("rc"); //filter release candidates button
            n = document.getElementById("n"); //filter nightlies button
            a = document.getElementById("a"); //text
            t = document.getElementById("t"); //text
            d = document.getElementById("d"); //select version
            f = document.getElementById("f"); //select build
            b = document.getElementById("b"); //button
            p = document.getElementById("p"); //progress bar
            //------------
            let hides = [fe, be, m, upload, d, f, b, a, t, r, rc, n];
            for (let i = 0; i < hides.length; i++) {
                hides[i].style.display = "none";
            }
            //------------
            p.style.width = "0";
            document.documentElement.style.setProperty("--color", "var(--" + type + "-color)");
            if (type === "manual") {
                setupManualPage();
                return;
            }
            filter('r');
            if (window.navigator.onLine === true) {
                //It's ok to download
                obj.list = await fetchReleases(type);
                obj.list.reverse();
                filter('r');
                d.onfocus=function () {
                    this.size = 10;
                    this.style.fontSize = "1.5em";
                    this.style.padding = "0";
                };
                d.onchange=function () {
                    this.size = 1;
                    this.blur();
                };
                d.onblur=function () {
                    this.size = 0;
                    this.style.fontSize = "unset";
                    this.style.padding = ".65em 2em";
                    fetchFiles();
                };
                f.onfocus=function () {
                    this.size = 5;
                    this.style.fontSize = "1.5em";
                    this.style.padding = "0";
                };
                f.onchange=function () {
                    this.size = 1;
                    this.blur();
                };
                f.onblur=function () {
                    this.size = 0;
                    this.style.fontSize = "unset";
                    this.style.padding = ".65em 2em";
                };
                t.innerHTML = obj[type].t;
                if (type === "frontend") {
                    fe.classList.add("active");
                    be.classList.remove("active");
                    m.classList.remove("active");
                }
                if (type === "backend") {
                    fe.classList.remove("active");
                    be.classList.add("active");
                    m.classList.remove("active");
                }
                let flexes = [fe, be, m, r, rc, n];
                for (let i = 0; i < flexes.length; i++) {
                    flexes[i].style.display = "flex";
                }
                let blocks = [d, f, b, a, t];
                for (let i = 0; i < blocks.length; i++) {
                    blocks[i].style.display = "block";
                }
                let innerHTMLs = [
                    [a, "a"],
                    [b, "b"]
                ];
                for (let i = 0; i < innerHTMLs.length; i++) {
                    innerHTMLs[i][0].innerHTML = obj[type][innerHTMLs[i][1]];
                }
            } else {
                //Cannot download
                setupManualPage('offline');
            }
        };
        setupManualPage = function (type = "") {
            let flexes = [fe, be, m, upload];
            for (let i = 0; i < flexes.length; i++) {
                flexes[i].style.display = "flex";
            }
            fe.classList.remove("active");
            be.classList.remove("active");
            m.classList.add("active");
            dragDropEvent(true);
            if (type === "offline") {
                let disables = [fe, be];
                for (let i = 0; i < disables.length; i++) {
                    disables[i].disabled = "true";
                    disables[i].style.cursor = "not-allowed";
                    disables[i].style.textDecorationLine = "line-through";
                    disables[i].style.textDecorationColor = "rgb(var(--" + type + "-color))";
                    disables[i].style.textDecorationStyle = "wavy";
                }
                m.disabled = "true";
                m.style.cursor = "not-allowed";
                document.documentElement.style.setProperty("--color", "var(--manual-color)");
                t.innerHTML = "No Internet connection. Please connect to Internet to download graphical user interface - OR - browse to a Queen.";
                t.style.color = "rgb(var(--" + type + "-color))";
                t.style.display = "block";
            }
        };
        filter = function (type) {
            r.classList.remove("active");
            rc.classList.remove("active");
            n.classList.remove("active");
            document.getElementById(type).classList.add("active");
            addOptions(type);
            fetchFiles();
        };
        fetchFiles = async function () {
            f.innerHTML = "";
            let version = d.value;
            let type = document.body.dataset.type;
            let info = "";
            if (version !== "") {
                info = await fetchInfo(type, version);
                for (let i = 0; i < info.files.length; i++) {
                    let option = document.createElement("option");
                    option.text = info.files[i].build + " (" + (Math.round(info.files[i].size * 10) / 10 / 1000).toFixed(1) + "kB)";
                    option.value = info.files[i].build;
                    f.add(option);
                }
            }
        };
        addOptions = function (type) {
            d.innerHTML = "";
            let contains = "";
            if (type === "rc") {
                contains = "rc";
            }
            if (type === "n") {
                contains = "nightly";
            }
            for (let i = 0; i < obj.list.length; i++) {
                if (obj.list[i] === "") {
                    continue;
                }
                if (contains === "") {
                    if (obj.list[i].includes("rc") || obj.list[i].includes("nightly")) {
                        continue;
                    }
                } else {
                    if (obj.list[i].includes(contains) !== true) {
                        continue;
                    }
                }
                let option = document.createElement("option");
                option.text = obj.list[i];
                option.value = obj.list[i];
                d.add(option);
            }
        };
        dragDropEvent = function () {
            let defaultText = upload.innerText.toString();
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                upload.addEventListener(eventName, function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }, false)
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                upload.addEventListener(eventName, function () {
                    upload.innerText = "Drop File Here...";
                    upload.classList.add('drag-drop');
                }, false)
            });
            ['dragleave', 'drop'].forEach(eventName => {
                upload.addEventListener(eventName, function (event) {
                    upload.classList.remove('drag-drop');
                    upload.innerText = defaultText;
                    if (eventName === "drop" && obj.file === "") {
                        let file = event.dataTransfer.files[0];
                        obj.file = file.name;
                        uploadFile(file);
                    }
                }, false)
            });
        };
        browseFile = function () {
            let i = document.createElement("input");
            i.type = "file";
            i.oninput = function (event) {
                let file = event.path[0].files[0];
                obj.file = file.name;
                uploadFile(file);
                i.remove();
            };
            i.dispatchEvent(new MouseEvent("click"));
        };
        uploadFile = function (file) {
            file.ext = file.name.match(/\.[0-9a-z]+$/i)[0].toLowerCase();
            console.log(file);
            setTimeout( function () {
                obj.file = "";
            }, 100);
        };
        fetchInfo = async function (type, version) {
            let info = {};
            const releaseList = obj[type].baseURL + version + "/info/" + obj[type].infoEndpoint + "?callback=" + Date.now();
            await fetch(releaseList)
                .then(res => res.text())
                .then((list) => {
                    let temp = list.split(/\n/);
                    for (let i = 0; i < temp.length; i++) {
                        let att = temp[i].replace(":", "||");
                        att = att.split("||");
                        info[att[0]] = att[1];
                    }
                })
                .catch(error => {
                    console.warn('Error fetching info: ' + error, 0, "error");
                });
            info.files = JSON.parse(info.files);
            return info;
        };
        fetchReleases = async function (type) {
            let rl = "";
            const releaseList = obj[type].baseURL + obj[type].rlEndpoint + "?callback=" + Date.now();
            await fetch(releaseList)
                .then(res => res.text())
                .then((list) => {
                    rl = list.split(/\n/);
                })
                .catch(error => {
                    console.warn('Error fetching releases: ' + error, 0, "error");
                });
            return rl;
        };
        update = function () {
            console.log(document.body.dataset.type);
            p.style.width = "20%";
        };
    </script>
</head>
<body onload="ini()">
<!-- This file is used as a minimum GUI to download the GUI from GitHub -->
<!-- Since Butler is used, do not rename or move the file /src/gui_easy_butler_gui_update.js !! -->
<div id="x">
    <div style="width:100%; display:inline-flex;">
        <button id="fe" style="width:45%;" onclick="start('frontend')">Front End</button>
        <button id="be" style="width:45%;" onclick="start('backend')">Back End</button>
        <button id="m" style="width:10%;" onclick="start('manual')">☰</button>
    </div>
    <div id="a"></div>
    <button id="upload" onclick="browseFile()">Click or Drag and Drop 1 File Onto This Area to Manually Upload a New Front or Back End to the Unit</button>
    <div style="width:100%; display:inline-flex;">
        <button id="r" style="width:40%;" onclick="filter('r')">Release</button>
        <button id="rc" style="width:30%;" onclick="filter('rc')">RC</button>
        <button id="n" style="width:30%;" onclick="filter('n')">Nightly</button>
    </div>
    <label for="d"></label>
    <select id="d"></select>
    <label for="f"></label>
    <select id="f"></select>
    <div id="t"></div>
    <button onclick="update()" id="b"></button>
    <div id="p"></div>
</div>
</body>
</html>